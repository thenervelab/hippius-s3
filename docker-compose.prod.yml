services:
  api:
    environment:
      - UVICORN_LOG_LEVEL=info
      - DEBUG=false
      - HIPPIUS_IPFS_GET_URL=https://get.hippius.network
      - HIPPIUS_IPFS_STORE_URL=https://store.hippius.network

  redis:
    command: ["redis-server", "/usr/local/etc/redis/redis.conf", "--maxmemory", "200gb"]

  downloader:
    deploy:
      replicas: 20

  ipfs:
    volumes:
      - /ipfs:/data/ipfs
    environment:
      - IPFS_PROFILE=server
      - IPFS_FD_MAX=8192
    user: "1000:1000"

# Remove the ipfs_data volume since we're using host mount
volumes:
  postgres_data:
