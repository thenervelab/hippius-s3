# Production/Development Environment Configuration
# This file is loaded AFTER .env.defaults and overrides base configuration.
# Copy this file to .env and fill in your production values.
#
# .env.defaults contains base configuration (feature flags, worker settings, limits)
# This file should contain:
#   - Connection strings (database, redis, IPFS)
#   - Production secrets (HMAC keys, seed phrases)
#   - Production-specific overrides of defaults

# Database Configuration
DATABASE_URL=postgresql://postgres:postgres@db:5432/hippius?sslmode=disable
HIPPIUS_KEYSTORE_DATABASE_URL=postgresql://postgres:postgres@db:5432/hippius_keys?sslmode=disable

# Redis Configuration (use docker service names for docker-compose)
REDIS_URL=redis://redis:6379/0
REDIS_ACCOUNTS_URL=redis://redis-accounts:6379/0
REDIS_CHAIN_URL=redis://redis-chain:6379/0
REDIS_QUEUES_URL=redis://redis-queues:6379/0
REDIS_RATE_LIMITING_URL=redis://redis-rate-limiting:6379/0

# IPFS Configuration
# For local development with docker-compose:
HIPPIUS_IPFS_GET_URL=http://ipfs:8080
HIPPIUS_IPFS_STORE_URL=http://ipfs:5001
# For production, use Hippius hosted nodes:
#HIPPIUS_IPFS_GET_URL=https://get.hippius.network
#HIPPIUS_IPFS_STORE_URL=https://store.hippius.network

# Security - CHANGE THIS IN PRODUCTION
FRONTEND_HMAC_SECRET=your-secret-key-here

# ============================================================================
# OPTIONAL: Override defaults from .env.defaults
# ============================================================================

# Logging (default: DEBUG in .env.defaults)
#LOG_LEVEL=INFO

# Environment marker (default: test in .env.defaults)
#ENVIRONMENT=production

# Feature Flags (defaults set in .env.defaults, override here for production)
#ENABLE_AUDIT_LOGGING=true
#ENABLE_STRICT_VALIDATION=true
#ENABLE_API_DOCS=false
#HIPPIUS_BYPASS_CREDIT_CHECK=false

# Rate Limiting (default: 100000 in .env.defaults for testing)
#RATE_LIMIT_PER_MINUTE=1000

# S3 Limits (defaults in .env.defaults, override for production if needed)
#MAX_BUCKET_NAME_LENGTH=100
#MAX_OBJECT_KEY_LENGTH=100
#MAX_METADATA_SIZE=200

# ============================================================================
# Additional Configuration
# ============================================================================

# Database Migration Tool (dbmate)
DBMATE_MIGRATIONS_DIR=/app/hippius_s3/sql/migrations
DBMATE_SCHEMA_FILE=/app/hippius_s3/sql/schema.sql

# Grafana Monitoring
GF_SERVER_ROOT_URL=https://s3.hippius.com
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/your-webhook-url-here

# Cachet Health Monitoring
CACHET_API_URL=https://status.example.com
CACHET_API_KEY=your-cachet-api-key-here
CACHET_COMPONENT_ID=1

# SQL backup credentials
AWS_BACKUP_ACCESS_KEY_ID=your-key-id
AWS_BACKUP_SECRET_ACCESS_KEY=your-secret-key-id
AWS_BACKUP_REGION=region
AWS_BACKUP_ENDPOINT_URL=https://your.endpoint.url

# ============================================================================
# KMS Configuration (for KEK wrapping)
# ============================================================================
# KEKs are wrapped (encrypted) before storage. Two modes are available:
#
# HIPPIUS_KMS_MODE=required (Production/Staging/E2E)
#   - KMS is mandatory, service fails at startup if not configured
#   - Provides HSM-backed protection for encryption keys at rest
#   - No silent fallback - misconfiguration crashes fast
#
# HIPPIUS_KMS_MODE=disabled (Development - default)
#   - KMS is off, use local software wrapping via HIPPIUS_AUTH_ENCRYPTION_KEY
#   - Local wrapping is NOT as secure as HSM-backed KMS - dev only!
#
# Key rotation is supported: new KEKs use the default key, old KEKs remain
# decryptable using their stored key ID.

# KMS Mode: "required" or "disabled" (default: disabled)
#HIPPIUS_KMS_MODE=required

# OVH KMS Configuration (required when KMS_MODE=required)
#HIPPIUS_OVH_KMS_ENDPOINT=https://eu-west-rbx.okms.ovh.net
#HIPPIUS_OVH_KMS_DEFAULT_KEY_ID=your-kms-key-uuid
#HIPPIUS_OVH_KMS_CERT_PATH=/path/to/client.crt
#HIPPIUS_OVH_KMS_KEY_PATH=/path/to/client.key
#HIPPIUS_OVH_KMS_CA_PATH=/path/to/ca.crt
#HIPPIUS_OVH_KMS_TIMEOUT_SECONDS=30.0
#HIPPIUS_OVH_KMS_MAX_RETRIES=3
#HIPPIUS_OVH_KMS_RETRY_BASE_MS=500
#HIPPIUS_OVH_KMS_RETRY_MAX_MS=5000
